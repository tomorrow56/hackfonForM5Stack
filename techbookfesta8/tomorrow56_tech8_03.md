---
title: hackfon for M5Stackの紹介
tags: M5Stack FutuRocket hackfon
author: tomorrow56 (ThousanDIY)
slide: false
---

# 開発中のhackfon for M5Stack の紹介

「hackfon」とは「アナログ電話をスマートリモコンに」というコンセプトで「FutuRocket株式会社」 (https://www.futurocket.co/) が現在製品化に向けて進めているIoTプロダクトです。

![hackfon](img/01_hackfon.jpg)

**hackfonのリーフレット**

筆者は「FutuRocket様」に許可をもらい、M5Stack版である「hackfon for M5Stack」の設計を進めていますので、簡単に紹介します。

## hackfonとは
「hackdon」は「Yahoo! JAPAN HackDay 2017」でHack賞を受賞した「アナログ固定電話機をWi-Fi接続しIoT/ウェブサービスのリモートコントローラーに変えるデバイス」です。
電話機のプッシュボタンを押すだけでデジタル家電やIoTデバイス、ウェブサービスをコントロールできるようになります。
「hackfon」はESP32ベースのデバイスで電源と電話機を接続するだけのシンプルな構成となっています。

## 「hackfon for M5Stack」の概要
オリジナルの「hackfon」は 10cm x 10cm で接続状態はLEDで表示します。また、Wi-Fiへの接続設定は内蔵しているWebブラウザ経由で行います。
これを「M5Stack用のモジュール」の形にすることで、M5Stackの液晶ディスプレイを利用した各種状態やコマンドの表示や、SDカードを使ったデータ保存に対応することができます。
以下は、今回に試作した「hackfon for M5Stack」です。接続した電話機のキーの検出して画面に表示しています。

![hackfon For M5Stack](img/02_hackfonForM5Stack.jpg)

**hackfon For M5Stack**

## オリジナルのhackfon との違い

M5Stackのモジュールサイズである 5cm x 5cm に収めるために以下の機能変更を行っています。

### 電話線用コネクタ(RJ11)の削減

オリジナルでは通常の電話機としても使用できるように電話線用のコネクタ(RJ11)を2個搭載し、リレーで切り替えを行っていますが、M5Stack版ではコネクタは1個になっています。これにより電話の公衆回線には繋げられなくなります。これにより「端末機器に関する基準認証制度」の適用除外になるというメリットもあります。

![RJ11コネクタ部](img/03_RJ11Connector.jpg)

**RJ11コネクタは1個のみ搭載**

### 内蔵レギュレータの削除

オリジナルではACアダプタ入力(12～15V、電話機の電源に使用)から内部回路用の5V及び3.3Vを生成していたのですが、M5Stack版では電源をM5StackのM-BUSから供給するようにしました。また、モジュールが厚くなるので、M5Stackのボトムモジュール(バッテリー内蔵)を使うことが難しくなります。そのため、本モジュールにLiPoバッテリーを直接接続できるようなコネクタを追加しました。また、メカニカルスイッチによりLiPoバッテリーをOFFできるようにしています。これによりM5Stackの弱点である「電源OFF時の内蔵バッテリーの放電」を改善することができます。

これらの変更を行うことにより、M5Stackのモジュール内にhackfonの機能をすべて実装することができました。以下が実装後の基板になります。下の方に見える青い2ピンのコネクタはLiPoバッテリー接続端子です。

![M5Stack版の実装済基板](img/04_assembledPCB.jpg)

**M5Stack版の実装済基板**

## 今後の展開について

現時点(2020年2月)ではM5Stack版は基本回路構成が固まって動作確認まで出来た段階です。
実際の製造開始までには、ハードウエアでは「中国での部品の調達性に応じた回路の見直し」「内蔵用のLiPoバッテリーの安全な固定方法」「ケースの設計・調達方法」、ソフトウエアでは「サービス連携をどうするか」「LCDによるユーザーインターフェースの設計」等、まだいくつもの課題があります。どのような形で販売するかも含めて引き続き検討していきます。
